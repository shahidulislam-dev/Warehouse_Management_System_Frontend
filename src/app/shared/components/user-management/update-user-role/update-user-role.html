<!--Update User Role html-->
<mat-dialog-content class="p-6 min-w-[90vw] md:min-w-[400px]">
  <!-- Header -->
  <div class="flex items-center justify-between mb-6">
    <h2 class="text-xl font-bold text-gray-800">Change User Role</h2>
    <button mat-icon-button (click)="onCancel()" class="text-gray-400 hover:text-gray-600" type="button">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- User Info -->
  <div class="bg-gray-50 rounded-lg p-4 mb-6">
    <div class="text-sm text-gray-600">
      <div class="font-semibold">{{ data.user.fullName }}</div>
      <div class="text-gray-500">{{ data.user.email }}</div>
      <div class="text-gray-500">Current Role: <span class="font-medium capitalize">{{ data.user.role }}</span></div>
    </div>
  </div>

  <!-- Warning for self-role-change -->
  <div *ngIf="!canChangeRole()" class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">
    <div class="flex items-center">
      <mat-icon class="text-yellow-600 mr-2">warning</mat-icon>
      <span class="text-yellow-800 text-sm">
        You cannot change your own role or modify users with higher privileges.
      </span>
    </div>
  </div>

  <!-- Form -->
  <form [formGroup]="roleForm" class="space-y-6">
    <!-- Role Selection -->
    <div class="space-y-2">
      <label class="block text-sm font-medium text-gray-700">Select New Role *</label>
      <mat-form-field appearance="outline" class="w-full">
        <mat-select formControlName="role" placeholder="Select role" [disabled]="!canChangeRole()">
          @for (role of availableRoles; track role) {
            <mat-option [value]="role">
              <span class="capitalize">{{ role }}</span>
            </mat-option>
          }
        </mat-select>
        <mat-icon matSuffix class="text-gray-400">badge</mat-icon>
        <mat-error *ngIf="roleForm.get('role')?.hasError('required')">
          Role is required
        </mat-error>
      </mat-form-field>
      
      <!-- Help text -->
      <div class="text-xs text-gray-500">
        <div *ngIf="authService.isSuperAdmin()">
          As Super Admin, you can assign any role to users.
        </div>
        <div *ngIf="authService.isAdmin() && !authService.isSuperAdmin()">
          As Admin, you can only promote staff users to Admin role.
        </div>
      </div>
    </div>
  </form>
</mat-dialog-content>

<mat-dialog-actions class="p-6 pt-0 justify-end gap-3">
  <div class="flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-3 w-full gap-3">
    <button type="button" (click)="onCancel()" [disabled]="loading" mat-button 
            class="w-full sm:w-auto px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200 font-medium disabled:opacity-50">
      Cancel
    </button>
    <button type="button" 
            [disabled]="roleForm.invalid || loading || !canChangeRole()" 
            mat-raised-button color="primary"
            class="w-full sm:w-auto px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
            (click)="onSubmit()">
      @if (loading) {
        <mat-spinner diameter="20"></mat-spinner>
      }
      <span>{{ loading ? 'Updating...' : 'Update Role' }}</span>
    </button>
  </div>
</mat-dialog-actions>